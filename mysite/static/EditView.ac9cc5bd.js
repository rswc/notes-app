import{d as N,u as F,r as v,c as j,a as c,w as P,T as q,b as G,o as a,e as x,v as S,f as n,g as U,h as i,i as D,F as B,j as E,t as w,_ as C,k as H,l as I,m as J,n as K,p as Q,q as W,s as X,x as R,y as Y}from"./index.8b9d6356.js";const Z={class:"dialog-container"},ee=n("h1",null,"Upload cover image",-1),te={class:"error-text"},ne={class:"dialog-actions"},oe=N({__name:"UploadCoverDialog",props:{show:{type:Boolean},note:null},emits:["close","changed"],setup(p,{emit:_}){const d=p,l=F(),t=v(),y=v(!1),e=()=>{var m;const f=(m=t.value)==null?void 0:m.files;f&&f[0]&&(y.value=!1,l.setCover(d.note,f[0]).then(g=>{g.success?(_("changed",g.note.cover),_("close")):y.value=!0}))};return(f,m)=>(a(),j(G,{to:"body"},[c(q,{name:"modal"},{default:P(()=>[x(n("div",{class:"dialog-wrapper",onClick:m[1]||(m[1]=U(g=>f.$emit("close"),["self"]))},[n("div",Z,[ee,n("input",{type:"file",ref_key:"imageInput",ref:t},null,512),x(n("div",te," An error occurred. Please try again later. ",512),[[S,y.value]]),n("div",ne,[n("button",{class:"btn-pill",onClick:m[0]||(m[0]=g=>f.$emit("close"))}," Cancel "),n("button",{class:"btn-pill primary",onClick:e}," Save ")])])],512),[[S,d.show]])]),_:1})]))}}),se=(p,_)=>{const d=new Date(p),l=Math.floor((_-d)/1e3);let t=l/31536e3;return t>2?Math.floor(t)+" years":t>1?"1 year":(t=l/2592e3,t>2?Math.floor(t)+" months":t>1?"1 month":(t=l/86400,t>2?Math.floor(t)+" days":t>1?"1 day":(t=l/3600,t>2?Math.floor(t)+" hours":t>1?"1 hour":(t=l/60,t>2?Math.floor(t)+" minutes":t>1?"1 minute":"<1 minute"))))};const le=(p,_)=>{const d=p.__vccOpts||p;for(const[l,t]of _)d[l]=t;return d},ae={},ue={class:"lds-ring"},ie=n("div",null,null,-1),re=n("div",null,null,-1),ce=n("div",null,null,-1),de=n("div",null,null,-1),ve=[ie,re,ce,de];function pe(p,_){return a(),i("div",ue,ve)}const _e=le(ae,[["render",pe]]),fe={style:{display:"flex"}},me={class:"tag-text"},ge=["onClick"],he=["onClick"],ye={class:"add-tag-container"},ke=["onClick"],be=N({__name:"TagsInput",props:{modelValue:null,note:null},emits:["update:modelValue"],setup(p,{emit:_}){const d=p,l=F(),t=v(""),y=v(),e=v(!1),f=()=>{e.value=!0,setTimeout(()=>{var r;(r=y.value)==null||r.focus()},0),window.addEventListener("click",()=>{e.value=!1})},m=D({get(){return d.modelValue},set(r){_("update:modelValue",r)}}),g=D(()=>l.tags.filter(r=>!m.value.includes(r)&&(!t.value||r.includes(t.value)))),k=r=>{const $=r||t.value;l.addTag(d.note,$),t.value="",e.value=!1},T=r=>{l.removeTag(d.note,r)};return(r,$)=>(a(),i("div",fe,[(a(!0),i(B,null,E(p.modelValue,u=>(a(),i("div",{class:"tag",key:u},[n("div",me,w(u),1),n("div",{class:"remove-tag",onClick:M=>T(u)},[c(C,{glyph:"plus"})],8,ge)]))),128)),n("div",{class:"tag add-tag-btn",onClick:U(f,["stop"])},[c(C,{glyph:"plus"}),c(q,{name:"modal"},{default:P(()=>[x(n("div",ye,[n("form",{onSubmit:$[1]||($[1]=U(u=>k(null),["prevent"]))},[x(n("input",{class:"add-tag-input",type:"text","onUpdate:modelValue":$[0]||($[0]=u=>t.value=u),ref_key:"inputTag",ref:y},null,512),[[H,t.value]])],32),(a(!0),i(B,null,E(I(g),u=>(a(),i("div",{class:"add-tag-option",key:u,onClick:M=>k(u)},w(u),9,ke))),128))],512),[[S,e.value]])]),_:1})],8,he)]))}});const $e={id:"note"},we={key:0},Ce={id:"menu-contianer"},xe={id:"menu"},Te=["disabled"],Ve=["disabled"],Ie=["disabled"],Se={style:{margin:"20px"}},Me={id:"info"},Be=N({__name:"EditView",props:{create:{type:Boolean}},setup(p){const _=p,d=X(),l=F(),t=v(),y=v(),e=v(null),f=v(Date.now()),m=D(()=>e.value?se(e.value.last_edited,f.value):""),g=D(()=>!!e.value&&e.value.id<0),k=v({});J(()=>{_.create?e.value={id:-1,name:"",content:"",owner:-1,date_created:"",last_edited:"",color:"white",tags:[],public:!1}:(l.details(d.params.id).then(h=>{e.value=h}),setInterval(()=>{f.value=Date.now()},6e4))});const T=v(!1),r=D(()=>T.value&&e.value),$=()=>{var h,s;T.value=!1,e.value&&(e.value.name=((h=t.value)==null?void 0:h.innerText)||"",e.value.content=((s=y.value)==null?void 0:s.innerText)||"",_.create?l.create(e.value).then(b=>{var o;if(b.success){const V=b.note;V.content=(o=e.value)==null?void 0:o.content,e.value=V,R.replace({name:"edit",params:{id:V.id}})}else k.value=b.errors}):l.save(e.value).then(b=>{var o,V;if(b.success){const L=b.note;L.content=(o=e.value)==null?void 0:o.content,L.name=((V=e.value)==null?void 0:V.name)||"",e.value=L,k.value={}}else k.value=b.errors}))},u=v(!1),M=v(!1),z=()=>{u.value=!1,R.replace("/")},A=h=>{e.value.cover=h},O=()=>{var h;l.setPublic(e.value,!((h=e.value)!=null&&h.public)).then(s=>{s.success&&(e.value.public=s.note.public)})};return(h,s)=>{const b=Y("RouterLink");return a(),i("main",$e,[e.value?(a(),i("article",we,[n("div",Ce,[n("div",xe,[c(b,{to:"/",class:"btn-icon"},{default:P(()=>[c(C,{glyph:"arrow-left"})]),_:1}),n("button",{class:"btn-icon",onClick:O},[x(c(C,{glyph:"lock"},null,512),[[S,!e.value.public]]),x(c(C,{glyph:"globe"},null,512),[[S,e.value.public]])]),n("button",{class:"btn-icon",disabled:I(g),onClick:s[0]||(s[0]=o=>{M.value=!0})},[c(C,{glyph:"media-image"})],8,Te),n("button",{class:"btn-icon",disabled:I(g),onClick:s[1]||(s[1]=o=>{u.value=!0})},[c(C,{glyph:"trash"})],8,Ve),n("button",{class:"btn-icon",disabled:!I(r),onClick:$},[c(C,{glyph:"save-floppy-disk"})],8,Ie)])]),e.value.cover?(a(),i("div",{key:0,id:"cover",style:K({"background-image":`url(${e.value.cover})`})},null,4)):Q("",!0),n("div",Se,[(a(!0),i(B,null,E(k.value.non_field_errors,o=>(a(),i("span",{class:"error-text",key:o},w(o),1))),128)),n("span",{id:"title",contenteditable:"","data-placeholder":"Title",onInput:s[2]||(s[2]=o=>{T.value=!0}),ref_key:"titleInput",ref:t},w(e.value.name),545),(a(!0),i(B,null,E(k.value.name,o=>(a(),i("span",{class:"error-text",key:o},w(o),1))),128)),n("div",Me,[c(be,{note:e.value,modelValue:e.value.tags,"onUpdate:modelValue":s[3]||(s[3]=o=>e.value.tags=o)},null,8,["note","modelValue"]),x(n("span",{style:{"text-align":"right"}},"Last edited: "+w(I(m))+" ago",513),[[S,!I(g)]])]),n("span",{id:"content",contenteditable:"","data-placeholder":"Take a note...",onInput:s[4]||(s[4]=o=>{T.value=!0}),ref_key:"contentInput",ref:y},w(e.value.content),545),(a(!0),i(B,null,E(k.value.content,o=>(a(),i("span",{class:"error-text",key:o},w(o),1))),128))]),c(W,{show:u.value,note:e.value,onClose:s[5]||(s[5]=o=>{u.value=!1}),onDeleted:z},null,8,["show","note"]),c(oe,{show:M.value,note:e.value,onClose:s[6]||(s[6]=o=>{M.value=!1}),onChanged:A},null,8,["show","note"])])):(a(),j(_e,{key:1}))])}}});export{Be as default};
